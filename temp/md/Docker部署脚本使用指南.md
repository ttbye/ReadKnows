# ğŸ³ Docker éƒ¨ç½²è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‹ è„šæœ¬æ¸…å•

æä¾›äº† 5 ä¸ªå®ç”¨çš„ Docker éƒ¨ç½²ç®¡ç†è„šæœ¬ï¼š

| è„šæœ¬ | åŠŸèƒ½ | äº¤äº’ | ä½¿ç”¨åœºæ™¯ |
|------|------|------|----------|
| `redeploy.sh` | å®Œæ•´é‡æ–°éƒ¨ç½² | âœ… äº¤äº’å¼ | æ­£å¼éƒ¨ç½²ã€å®Œæ•´æ›´æ–° |
| `deploy-quick.sh` | å¿«é€Ÿéƒ¨ç½² | âŒ æ— äº¤äº’ | è‡ªåŠ¨åŒ–ã€å¿«é€Ÿé‡å¯ |
| `docker-restart.sh` | é‡å¯å®¹å™¨ | âŒ æ— äº¤äº’ | é…ç½®ä¿®æ”¹åé‡å¯ |
| `docker-logs.sh` | æŸ¥çœ‹æ—¥å¿— | âœ… äº¤äº’å¼ | è°ƒè¯•ã€æ’æŸ¥é—®é¢˜ |
| `docker-status.sh` | çŠ¶æ€æ£€æŸ¥ | âŒ æ— äº¤äº’ | å¥åº·æ£€æŸ¥ã€ç›‘æ§ |

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### 1ï¸âƒ£ å®Œæ•´é‡æ–°éƒ¨ç½²ï¼ˆæ¨èï¼‰â­

```bash
./redeploy.sh
```

**åŠŸèƒ½**ï¼š
- âœ… åœæ­¢ç°æœ‰å®¹å™¨
- âœ… å¯é€‰ï¼šæ‹‰å–æœ€æ–°ä»£ç 
- âœ… å¯é€‰ï¼šæ¸…ç†æ—§é•œåƒ
- âœ… é‡æ–°æ„å»ºé•œåƒ
- âœ… å¯åŠ¨å®¹å™¨
- âœ… æ£€æŸ¥å¥åº·çŠ¶æ€
- âœ… å¯é€‰ï¼šæŸ¥çœ‹æ—¥å¿—

**é€‚ç”¨åœºæ™¯**ï¼š
- ä»£ç æ›´æ–°åé‡æ–°éƒ¨ç½²
- é…ç½®æ–‡ä»¶ä¿®æ”¹åéƒ¨ç½²
- å®šæœŸç»´æŠ¤æ›´æ–°

**æ‰§è¡Œæµç¨‹**ï¼š

```
ğŸš€ å¼€å§‹é‡æ–°éƒ¨ç½² KnowBooks
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¶ï¸  æ­¥éª¤ 1/7: åœæ­¢ç°æœ‰å®¹å™¨
â„¹ï¸  æ­£åœ¨åœæ­¢å®¹å™¨...
âœ… å®¹å™¨å·²åœæ­¢

â–¶ï¸  æ­¥éª¤ 2/7: æ›´æ–°ä»£ç ï¼ˆå¯é€‰ï¼‰
æ˜¯å¦æ‹‰å–æœ€æ–°ä»£ç ï¼Ÿ(y/N): y
â„¹ï¸  æ­£åœ¨æ‹‰å–æœ€æ–°ä»£ç ...
âœ… ä»£ç å·²æ›´æ–°

â–¶ï¸  æ­¥éª¤ 3/7: æ¸…ç†æ—§é•œåƒï¼ˆå¯é€‰ï¼‰
æ˜¯å¦æ¸…ç†æ—§çš„ Docker é•œåƒï¼Ÿ(y/N): n
âš ï¸  è·³è¿‡é•œåƒæ¸…ç†

â–¶ï¸  æ­¥éª¤ 4/7: é‡æ–°æ„å»ºé•œåƒ
â„¹ï¸  æ­£åœ¨æ„å»ºé•œåƒï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...
âœ… é•œåƒæ„å»ºå®Œæˆ

â–¶ï¸  æ­¥éª¤ 5/7: å¯åŠ¨å®¹å™¨
â„¹ï¸  æ­£åœ¨å¯åŠ¨å®¹å™¨...
âœ… å®¹å™¨å·²å¯åŠ¨

â–¶ï¸  æ­¥éª¤ 6/7: ç­‰å¾…æœåŠ¡å°±ç»ª
â„¹ï¸  ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆ30ç§’ï¼‰...
âœ… ç­‰å¾…å®Œæˆ

â–¶ï¸  æ­¥éª¤ 7/7: æ£€æŸ¥æœåŠ¡çŠ¶æ€
â„¹ï¸  å®¹å™¨çŠ¶æ€ï¼š
NAME                  COMMAND                  SERVICE     STATUS      PORTS
knowbooks-backend     "docker-entrypoint.sâ€¦"   backend     running     0.0.0.0:3001->3001/tcp
knowbooks-frontend    "/docker-entrypoint.â€¦"   frontend    running     0.0.0.0:1280->80/tcp

âœ… åç«¯æœåŠ¡æ­£å¸¸ (http://localhost:3001)
âœ… å‰ç«¯æœåŠ¡æ­£å¸¸ (http://localhost:1280)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… éƒ¨ç½²å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ˜¯å¦æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Ÿ(y/N):
```

---

### 2ï¸âƒ£ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ— äº¤äº’ï¼‰

```bash
./deploy-quick.sh
```

**åŠŸèƒ½**ï¼š
- âœ… åœæ­¢å®¹å™¨
- âœ… é‡æ–°æ„å»ºé•œåƒï¼ˆæ— ç¼“å­˜ï¼‰
- âœ… å¯åŠ¨å®¹å™¨
- âœ… ç­‰å¾…å¹¶æ£€æŸ¥çŠ¶æ€

**é€‚ç”¨åœºæ™¯**ï¼š
- è‡ªåŠ¨åŒ–è„šæœ¬è°ƒç”¨
- CI/CD æµç¨‹
- å¿«é€Ÿé‡å»ºä¸éœ€è¦äº¤äº’

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ KnowBooks å¿«é€Ÿéƒ¨ç½²
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¶ï¸  åœæ­¢å®¹å™¨...
â–¶ï¸  æ„å»ºé•œåƒ...
â–¶ï¸  å¯åŠ¨å®¹å™¨...
â–¶ï¸  ç­‰å¾…æœåŠ¡å¯åŠ¨...

âœ… éƒ¨ç½²å®Œæˆï¼

NAME                  STATUS      PORTS
knowbooks-backend     running     0.0.0.0:3001->3001/tcp
knowbooks-frontend    running     0.0.0.0:1280->80/tcp

â„¹ï¸  è®¿é—®åœ°å€: http://localhost:1280
â„¹ï¸  æŸ¥çœ‹æ—¥å¿—: docker-compose logs -f
```

---

### 3ï¸âƒ£ é‡å¯å®¹å™¨

```bash
./docker-restart.sh
```

**åŠŸèƒ½**ï¼š
- âœ… é‡å¯æ‰€æœ‰å®¹å™¨ï¼ˆä¸é‡æ–°æ„å»ºï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¿®æ”¹äº†ç¯å¢ƒå˜é‡
- ä¿®æ”¹äº† docker-compose.yml
- å®¹å™¨å¼‚å¸¸éœ€è¦é‡å¯

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
ğŸ”„ é‡å¯ KnowBooks å®¹å™¨...
Restarting knowbooks-frontend ... done
Restarting knowbooks-backend  ... done

âœ… é‡å¯å®Œæˆï¼

NAME                  STATUS      PORTS
knowbooks-backend     running     0.0.0.0:3001->3001/tcp
knowbooks-frontend    running     0.0.0.0:1280->80/tcp
```

---

### 4ï¸âƒ£ æŸ¥çœ‹æ—¥å¿—

```bash
./docker-logs.sh
```

**åŠŸèƒ½**ï¼š
- âœ… äº¤äº’å¼é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—
- âœ… æ”¯æŒå®æ—¶æ—¥å¿—å’Œå†å²æ—¥å¿—

**é€‚ç”¨åœºæ™¯**ï¼š
- è°ƒè¯•é—®é¢˜
- æ’æŸ¥é”™è¯¯
- ç›‘æ§è¿è¡ŒçŠ¶æ€

**äº¤äº’ç•Œé¢**ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š KnowBooks æ—¥å¿—æŸ¥çœ‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¯·é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—ï¼š
  1) æ‰€æœ‰æœåŠ¡
  2) åç«¯æœåŠ¡
  3) å‰ç«¯æœåŠ¡
  4) æœ€è¿‘50è¡Œï¼ˆæ‰€æœ‰æœåŠ¡ï¼‰
  5) æœ€è¿‘50è¡Œï¼ˆåç«¯ï¼‰
  6) æœ€è¿‘50è¡Œï¼ˆå‰ç«¯ï¼‰

è¯·è¾“å…¥é€‰é¡¹ (1-6): 2

ğŸ“Š æ˜¾ç¤ºåç«¯æœåŠ¡å®æ—¶æ—¥å¿—ï¼ˆCtrl+C é€€å‡ºï¼‰...

knowbooks-backend  | [2025-12-11 13:00:00] æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£ 3001
knowbooks-backend  | [2025-12-11 13:00:05] æ•°æ®åº“è¿æ¥æˆåŠŸ
knowbooks-backend  | [2025-12-11 13:00:10] æ”¶åˆ°è¯·æ±‚ GET /api/books
...
```

---

### 5ï¸âƒ£ çŠ¶æ€æ£€æŸ¥

```bash
./docker-status.sh
```

**åŠŸèƒ½**ï¼š
- âœ… å®¹å™¨è¿è¡ŒçŠ¶æ€
- âœ… æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… ç£ç›˜ä½¿ç”¨æƒ…å†µ
- âœ… èµ„æºä½¿ç”¨æƒ…å†µ
- âœ… æœ€è¿‘é”™è¯¯æ—¥å¿—
- âœ… å¸¸ç”¨å‘½ä»¤æç¤º

**é€‚ç”¨åœºæ™¯**ï¼š
- æ—¥å¸¸å¥åº·æ£€æŸ¥
- ç›‘æ§ç³»ç»ŸçŠ¶æ€
- å¿«é€Ÿè¯Šæ–­é—®é¢˜

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” KnowBooks çŠ¶æ€æ£€æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ å®¹å™¨çŠ¶æ€ï¼š
NAME                  STATUS      PORTS
knowbooks-backend     running     0.0.0.0:3001->3001/tcp
knowbooks-frontend    running     0.0.0.0:1280->80/tcp

ğŸ”§ åç«¯æœåŠ¡æ£€æŸ¥ï¼š
  âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
     åœ°å€: http://localhost:3001

ğŸŒ å‰ç«¯æœåŠ¡æ£€æŸ¥ï¼š
  âœ… å‰ç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
     åœ°å€: http://localhost:1280

ğŸ’¾ Docker ç£ç›˜ä½¿ç”¨ï¼š
TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
Images          15        2         1.5GB     1.2GB (80%)
Containers      2         2         100MB     0B (0%)
Local Volumes   3         3         500MB     0B (0%)

ğŸ“Š å®¹å™¨èµ„æºä½¿ç”¨ï¼š
NAME                CPU %     MEM USAGE / LIMIT
knowbooks-backend   2.5%      150MB / 2GB
knowbooks-frontend  0.5%      50MB / 512MB

âš ï¸  æœ€è¿‘çš„é”™è¯¯æ—¥å¿—ï¼ˆåç«¯ï¼‰ï¼š
  âœ… æ— é”™è¯¯

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ å¸¸ç”¨å‘½ä»¤ï¼š

  æŸ¥çœ‹æ—¥å¿—:    ./docker-logs.sh
  é‡å¯æœåŠ¡:    ./docker-restart.sh
  é‡æ–°éƒ¨ç½²:    ./redeploy.sh
  å¿«é€Ÿéƒ¨ç½²:    ./deploy-quick.sh
  åœæ­¢æœåŠ¡:    docker-compose down

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯å¯¹ç…§

### åœºæ™¯1: æ›´æ–°ä»£ç åéƒ¨ç½²

```bash
# æ–¹æ³•1: å®Œæ•´æµç¨‹ï¼ˆæ¨èï¼‰
./redeploy.sh
# é€‰æ‹© y æ‹‰å–ä»£ç 
# é€‰æ‹© n ä¸æ¸…ç†é•œåƒï¼ˆæ›´å¿«ï¼‰

# æ–¹æ³•2: å¿«é€Ÿéƒ¨ç½²
git pull
./deploy-quick.sh
```

---

### åœºæ™¯2: ä¿®æ”¹é…ç½®æ–‡ä»¶å

```bash
# å¦‚æœåªä¿®æ”¹äº† docker-compose.yml æˆ–ç¯å¢ƒå˜é‡
./docker-restart.sh

# å¦‚æœä¿®æ”¹äº† Dockerfile æˆ–ä»£ç 
./redeploy.sh
```

---

### åœºæ™¯3: è°ƒè¯•é—®é¢˜

```bash
# 1. æ£€æŸ¥çŠ¶æ€
./docker-status.sh

# 2. æŸ¥çœ‹æ—¥å¿—
./docker-logs.sh

# 3. å¦‚æœéœ€è¦é‡å¯
./docker-restart.sh
```

---

### åœºæ™¯4: å®šæœŸç»´æŠ¤

```bash
# å®Œæ•´é‡æ–°éƒ¨ç½²ï¼Œæ¸…ç†æ—§é•œåƒ
./redeploy.sh
# é€‰æ‹© y æ‹‰å–ä»£ç 
# é€‰æ‹© y æ¸…ç†é•œåƒ
```

---

## ğŸ“Š è„šæœ¬å¯¹æ¯”

| ç‰¹æ€§ | redeploy.sh | deploy-quick.sh | docker-restart.sh | docker-logs.sh | docker-status.sh |
|------|-------------|-----------------|-------------------|----------------|------------------|
| é‡æ–°æ„å»º | âœ… | âœ… | âŒ | âŒ | âŒ |
| æ¸…ç†é•œåƒ | å¯é€‰ | âŒ | âŒ | âŒ | âŒ |
| æ‹‰å–ä»£ç  | å¯é€‰ | âŒ | âŒ | âŒ | âŒ |
| å¥åº·æ£€æŸ¥ | âœ… | âœ… | âœ… | âŒ | âœ… |
| æŸ¥çœ‹æ—¥å¿— | å¯é€‰ | âŒ | âŒ | âœ… | éƒ¨åˆ† |
| äº¤äº’å¼ | âœ… | âŒ | âŒ | âœ… | âŒ |
| æ‰§è¡Œæ—¶é—´ | 5-10åˆ†é’Ÿ | 3-5åˆ†é’Ÿ | 10ç§’ | å³æ—¶ | å³æ—¶ |

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. è‡ªåŠ¨åŒ–éƒ¨ç½²

```bash
# åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
crontab -e

# æ·»åŠ ï¼š
0 2 * * * cd /volume5/docker/bookpath/install && ./deploy-quick.sh >> /tmp/knowbooks-deploy.log 2>&1
```

---

### 2. è¿œç¨‹éƒ¨ç½²

```bash
# SSH è¿œç¨‹æ‰§è¡Œ
ssh user@server "cd /volume5/docker/bookpath/install && ./redeploy.sh"

# æˆ–ä½¿ç”¨å¿«é€Ÿæ¨¡å¼
ssh user@server "cd /volume5/docker/bookpath/install && ./deploy-quick.sh"
```

---

### 3. ç»„åˆä½¿ç”¨

```bash
# éƒ¨ç½²åç«‹å³æŸ¥çœ‹æ—¥å¿—
./deploy-quick.sh && ./docker-logs.sh

# é‡å¯åæ£€æŸ¥çŠ¶æ€
./docker-restart.sh && sleep 5 && ./docker-status.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Ÿ

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.sh

# éªŒè¯
ls -lh *.sh
```

---

### Q2: docker-compose å‘½ä»¤ä¸å­˜åœ¨ï¼Ÿ

```bash
# æ£€æŸ¥ Docker å®‰è£…
docker --version
docker-compose --version

# å¦‚æœæ˜¯æ–°ç‰ˆ Dockerï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨
docker compose version
```

---

### Q3: ç«¯å£è¢«å ç”¨ï¼Ÿ

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :1280
lsof -i :3001

# åœæ­¢å ç”¨çš„è¿›ç¨‹æˆ–ä¿®æ”¹ docker-compose.yml ç«¯å£
```

---

### Q4: æ„å»ºå¤±è´¥ï¼Ÿ

```bash
# 1. æ¸…ç†æ‰€æœ‰å®¹å™¨å’Œé•œåƒ
docker-compose down --rmi all
docker system prune -a -f

# 2. é‡æ–°æ„å»º
./deploy-quick.sh

# 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs backend
```

---

## ğŸ“ æ‰‹åŠ¨å‘½ä»¤å¯¹ç…§

å¦‚æœè„šæœ¬æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# ç›¸å½“äº ./redeploy.shï¼ˆç®€åŒ–ç‰ˆï¼‰
docker-compose down
docker-compose build --no-cache
docker-compose up -d
docker-compose ps

# ç›¸å½“äº ./docker-restart.sh
docker-compose restart

# ç›¸å½“äº ./docker-logs.shï¼ˆé€‰é¡¹2ï¼‰
docker-compose logs -f backend

# ç›¸å½“äº ./docker-status.shï¼ˆç®€åŒ–ç‰ˆï¼‰
docker-compose ps
curl http://localhost:3001/api/health
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œé€é¡¹æ£€æŸ¥ï¼š

- [ ] å®¹å™¨çŠ¶æ€æ­£å¸¸ï¼ˆ`./docker-status.sh`ï¼‰
- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡ï¼ˆ`curl http://localhost:3001/api/health`ï¼‰
- [ ] å‰ç«¯å¯ä»¥è®¿é—®ï¼ˆ`curl http://localhost:1280`ï¼‰
- [ ] æ²¡æœ‰é”™è¯¯æ—¥å¿—ï¼ˆ`./docker-logs.sh` é€‰é¡¹5ï¼‰
- [ ] æ•°æ®åº“æ–‡ä»¶å­˜åœ¨
- [ ] import ç›®å½•å¯å†™
- [ ] ä¹¦ç±æ–‡ä»¶å¯è®¿é—®

---

## ğŸ‰ æ€»ç»“

### æ—¥å¸¸ä½¿ç”¨æ¨è

```bash
# æ—¥å¸¸éƒ¨ç½²
./redeploy.sh

# å¿«é€Ÿæ£€æŸ¥
./docker-status.sh

# æŸ¥çœ‹é—®é¢˜
./docker-logs.sh
```

### ä¸€é”®å‘½ä»¤

```bash
# æœ€ç®€å•çš„é‡æ–°éƒ¨ç½²
./deploy-quick.sh
```

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-11  
**ç‰ˆæœ¬**ï¼š1.0.0  
**é€‚ç”¨ç¯å¢ƒ**ï¼šDocker Compose v2+

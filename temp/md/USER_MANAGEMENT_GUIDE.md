# 用户管理功能说明

## 功能概述

已完善的用户管理系统，提供完整的用户增删改查和权限管理功能。

## 主要功能

### 1. 用户列表管理
- ✅ 展示所有用户的详细信息
- ✅ 显示用户的统计数据（上传书籍数、书架数）
- ✅ 搜索功能（支持用户名和邮箱搜索）
- ✅ 分页功能（每页20条记录）
- ✅ 响应式表格设计，支持暗色模式

### 2. 创建新用户
- ✅ 管理员可以直接创建新用户账号
- ✅ 设置用户的基本信息：
  - 用户名（必填）
  - 邮箱（必填）
  - 密码（必填，至少6位）
  - 角色（普通用户/管理员）
- ✅ 实时验证表单输入
- ✅ 友好的模态框界面

### 3. 编辑用户信息
- ✅ 修改用户邮箱
- ✅ 用户名注册后不可修改（防止数据混乱）
- ✅ 管理员不能通过此界面修改自己的信息（需通过个人设置）

### 4. 权限管理
- ✅ 快速切换用户角色（普通用户 ↔ 管理员）
- ✅ 下拉选择器，操作便捷
- ✅ 安全限制：
  - 管理员不能修改自己的角色
  - 系统至少保留一个管理员账号
  - 自己的角色显示为只读标签

### 5. 密码管理
- ✅ 管理员可以重置任何用户的密码
- ✅ 密码长度验证（至少6位）
- ✅ 安全的密码加密存储

### 6. 删除用户
- ✅ 删除用户账号及相关数据
- ✅ 二次确认机制，防止误操作
- ✅ 安全限制：
  - 管理员不能删除自己
  - 至少保留一个管理员账号
  - 级联删除用户相关的所有数据

## 后端API接口

### 用户管理相关接口（需要管理员权限）

#### 1. 获取用户列表
```
GET /api/users
参数：
  - page: 页码（默认1）
  - limit: 每页数量（默认20）
  - search: 搜索关键词（可选）
```

#### 2. 创建新用户
```
POST /api/users
请求体：
  {
    "username": "用户名",
    "email": "邮箱",
    "password": "密码",
    "role": "user|admin"  // 可选，默认user
  }
```

#### 3. 获取单个用户信息
```
GET /api/users/:id
```

#### 4. 更新用户信息
```
PUT /api/users/:id
请求体：
  {
    "email": "新邮箱"
  }
```

#### 5. 更新用户角色
```
PUT /api/users/:id/role
请求体：
  {
    "role": "user|admin"
  }
```

#### 6. 重置用户密码
```
PUT /api/users/:id/password
请求体：
  {
    "password": "新密码"
  }
```

#### 7. 删除用户
```
DELETE /api/users/:id
```

## 安全机制

### 权限控制
- 所有用户管理接口都需要管理员权限
- 使用JWT令牌进行身份验证
- 中间件层面的权限检查

### 数据验证
- 前后端双重验证
- 邮箱格式验证
- 用户名和邮箱唯一性检查
- 密码强度要求（至少6位）

### 操作限制
- 管理员不能删除或修改自己的关键信息
- 系统至少保留一个管理员账号
- 删除操作需要二次确认

### 密码安全
- 使用bcrypt加密存储密码
- 密码永不明文传输或存储
- 安全的密码重置机制

## 前端路由

访问路径：`/users`

只有管理员可以访问此页面，普通用户会看到权限提示。

## UI/UX特性

### 视觉设计
- 现代化的卡片式布局
- 支持深色模式
- 渐变色按钮和图标
- 清晰的表格展示

### 交互体验
- 实时搜索，无需点击按钮
- 模态框弹窗，不跳转页面
- 操作反馈（成功/失败提示）
- 加载状态显示
- 禁用状态处理

### 响应式设计
- 适配桌面和移动设备
- 表格横向滚动支持
- 触摸友好的按钮大小

## 使用建议

### 创建用户
1. 点击"创建用户"按钮
2. 填写用户信息
3. 选择用户角色
4. 点击"确认创建"

### 修改用户信息
1. 点击用户行的"编辑"图标
2. 修改邮箱信息
3. 点击"保存修改"

### 修改用户权限
1. 直接在表格中的角色下拉框中选择新角色
2. 系统自动保存

### 重置密码
1. 点击用户行的"钥匙"图标
2. 输入新密码（至少6位）
3. 点击"确认重置"

### 删除用户
1. 点击用户行的"删除"图标
2. 在确认对话框中点击"确定"
3. 注意：此操作不可恢复

## 数据统计

每个用户显示以下统计信息：
- 上传的书籍数量
- 创建的书架数量
- 注册时间

## 注意事项

1. **至少保留一个管理员**：系统要求至少有一个管理员账号，删除或降级最后一个管理员会被阻止

2. **用户名不可修改**：用户名在注册后不能修改，这是为了保持系统数据的一致性

3. **权限管理**：只有管理员可以访问用户管理页面和相关API

4. **数据安全**：删除用户会级联删除该用户的所有相关数据（书架、阅读历史等）

5. **密码安全**：管理员重置的密码应该告知用户，建议用户登录后立即修改

## 技术栈

### 后端
- Express.js - Web框架
- better-sqlite3 - 数据库
- bcryptjs - 密码加密
- jsonwebtoken - 身份验证
- uuid - 生成用户ID

### 前端
- React - UI框架
- TypeScript - 类型安全
- Tailwind CSS - 样式框架
- lucide-react - 图标库
- react-hot-toast - 消息提示
- axios - HTTP客户端

## 更新日志

**2025-12-11**
- ✅ 添加创建用户功能
- ✅ 添加编辑用户信息功能
- ✅ 优化用户列表界面
- ✅ 完善权限管理机制
- ✅ 改进UI/UX设计
- ✅ 添加更多安全验证

---

完善后的用户管理系统提供了全面的用户账号管理能力，满足多用户环境下的管理需求。

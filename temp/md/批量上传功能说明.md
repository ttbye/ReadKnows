# 📚 批量上传功能说明

## 🎯 新功能

在上传页面新增了**批量选择本地文件**功能，支持：

1. ✅ 一次选择多个文件
2. ✅ 显示文件列表，可勾选/取消
3. ✅ 逐个上传，实时显示进度
4. ✅ 单独显示每个文件的上传结果

---

## 🚀 使用方法

### 步骤1: 选择文件

<details>
<summary>点击展开详细步骤</summary>

1. 进入"上传书籍"页面
2. 找到**"批量选择"**卡片（紫色边框）
3. 点击"点击批量选择文件"
4. 在文件选择器中：
   - 按住 `Ctrl`（Windows）或 `Cmd`（Mac）多选文件
   - 或按住 `Shift` 选择连续的文件
   - 或直接框选多个文件
5. 点击"打开"

</details>

### 步骤2: 查看文件列表

- 所有选择的文件会显示在**"本地文件列表"**
- 默认全部勾选
- 可以：
  - 取消勾选不想上传的文件
  - 点击"全选"或"取消全选"
  - 点击垃圾桶图标移除单个文件

### 步骤3: 批量上传

1. 确认选择的文件
2. 点击右上角的**"批量上传 (N)"**按钮
3. 系统会逐个上传文件：
   - 显示进度：上传中 (1/10)...
   - 每个文件上传后显示✓或✗
4. 上传成功的文件自动从列表移除

---

## 📋 三种上传方式对比

| 方式 | 适用场景 | 特点 |
|------|---------|------|
| **单文件上传** | 少量书籍、快速上传 | 简单快捷 |
| **批量选择（新）** | 本地多个文件 | ⭐ 可选择性上传、显示进度 |
| **目录扫描** | 服务器目录 | 扫描Docker挂载的目录 |

---

## 🌟 功能亮点

### 1. 灵活选择

```
可以从不同文件夹选择文件
├── 书籍/小说/book1.epub     ← 选择
├── 文档/技术/book2.pdf      ← 选择
└── 下载/book3.txt          ← 选择
```

### 2. 实时反馈

```
上传进度：
✓ book1.epub - 上传成功
✓ book2.pdf - 上传成功
✗ book3.txt - 文件格式错误

总结：成功 2 本，失败 1 本
```

### 3. 断点续传

- 上传失败的文件保留在列表
- 可以重新勾选再次上传
- 成功的自动移除

---

## 💡 使用技巧

### 技巧1: 分类上传

先设置好分类和选项，然后批量上传：

1. 选择分类（如"小说"）
2. 选择多个小说文件
3. 批量上传
4. 再换分类（如"技术"）
5. 选择技术书籍
6. 再次上传

### 技巧2: 文件筛选

在文件选择器中使用过滤：

```
Windows: 在文件类型下拉框选择 "*.epub"
Mac: 在"格式"中选择相应的文件类型
```

### 技巧3: 检查后上传

1. 先选择所有文件
2. 查看文件列表
3. 取消勾选不想上传的
4. 再批量上传

---

## ⚙️ 导入选项

所有三种上传方式**共享**相同的导入选项：

### 必选项

- **📚 书籍分类**：选择分类（默认"未分类"）

### 可选项

- **🔍 自动从豆瓣获取书籍信息**：自动获取封面、简介等
- **🌐 设为公开书籍**：是否让所有用户可见
- **📄 自动将TXT转换为EPUB**：TXT文件自动转换
- **📱 自动将MOBI转换为EPUB**：MOBI文件自动转换
- **🗑️ 导入后删除源文件**：仅影响服务器目录扫描

---

## 🎯 最佳实践

### 日常使用（推荐）⭐⭐⭐

**场景**：从电脑下载文件夹选择10本书

```
1. 打开上传页面
2. 设置分类为"小说"
3. 点击"批量选择"
4. 在下载文件夹选择10个EPUB文件
5. 确认列表无误
6. 点击"批量上传"
7. 等待完成（显示进度）
```

### 大量书籍

**场景**：有100+本书要上传

```
方案1: 批量选择（推荐桌面环境）
- 分批上传，每次20-30本
- 可以按分类分批

方案2: 服务器目录扫描
- 如果在服务器上，使用import目录
- 或挂载目录后扫描
```

### 快速单本

**场景**：刚下载了一本书，立即上传

```
使用"单文件上传"最快：
1. 点击单文件上传区域
2. 选择文件
3. 立即上传
```

---

## ❓ 常见问题

### Q1: 为什么我的文件没有显示在列表中？

**A**: 检查：
1. 文件格式是否支持（EPUB、PDF、TXT、MOBI）
2. 是否成功选择了文件
3. 查看浏览器控制台是否有错误

---

### Q2: 可以选择文件夹吗？

**A**: 不能。浏览器安全限制不允许选择文件夹。

**解决方案**：
- 在文件选择器中按住 `Ctrl/Cmd` 多选文件
- 或使用"服务器目录扫描"（需要Docker挂载）

---

### Q3: 上传速度慢怎么办？

**A**: 
- 批量上传是**逐个上传**，不是并发
- 这样可以显示准确进度，避免服务器压力
- 如果文件很多，建议分批上传

---

### Q4: 上传失败的文件怎么办？

**A**:
- 失败的文件会保留在列表中
- 查看错误提示（每个文件单独显示）
- 修复问题后，重新勾选再上传

---

### Q5: 批量上传和服务器扫描有什么区别？

**A**:

| 特性 | 批量上传 | 服务器扫描 |
|------|---------|-----------|
| 文件来源 | 本地电脑 | 服务器/Docker |
| 选择方式 | 文件选择器 | 路径输入 |
| 文件移动 | 需要上传 | 已在服务器 |
| 删除源文件 | 不删除 | 可选删除 |
| 适用场景 | 日常添加 | 批量导入 |

---

## 🎨 界面说明

### 卡片颜色

- **蓝色**：单文件上传
- **紫色**：批量选择本地文件 ⭐ 新功能
- **绿色**：服务器目录扫描

### 文件列表

- **紫色边框列表**：本地选择的文件
- **普通列表**：服务器扫描的文件

---

## 🔄 工作流程

```
用户操作             →  系统处理               →  结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 点击"批量选择"   →  打开文件选择器        →  选择多个文件

2. 选择10个文件     →  显示在文件列表        →  默认全选

3. 取消勾选2个      →  更新选择状态          →  已选择 8 个

4. 点击"批量上传"   →  逐个上传（1/8...）   →  实时显示进度

5. 上传完成         →  显示结果汇总          →  成功7本，失败1本

6. 成功的文件       →  自动移除              →  列表中剩1个失败的
```

---

## 🚀 部署说明

### 前端修改

文件：`frontend/src/pages/Upload.tsx`

**新增功能**：
1. 批量文件选择
2. 本地文件列表
3. 逐个上传逻辑
4. 进度显示

### 无需后端修改

使用现有的 `/books/upload` API，逐个调用。

---

## 📊 性能说明

### 上传速度

- 单个文件：取决于网络速度
- 批量上传：串行上传，不会并发
- 10MB文件约需3-5秒（视网络而定）

### 内存占用

- 文件不会全部加载到内存
- 使用 FormData 流式上传
- 适合大文件

---

## ✅ 验证清单

部署后测试：

- [ ] 可以点击批量选择按钮
- [ ] 文件选择器支持多选
- [ ] 文件列表正确显示
- [ ] 可以勾选/取消勾选
- [ ] 批量上传按钮可用
- [ ] 上传进度正确显示
- [ ] 单个文件结果显示
- [ ] 成功的文件自动移除
- [ ] 失败的文件保留在列表

---

## 🎉 总结

**批量选择本地文件**功能：

- ✅ 简单易用
- ✅ 灵活选择
- ✅ 实时反馈
- ✅ 进度可见
- ✅ 无需后端修改

**推荐使用场景**：
- 日常添加书籍
- 从下载文件夹选择
- 需要查看文件列表
- 需要选择性上传

---

**更新日期**：2025-12-11  
**版本**：1.3.0

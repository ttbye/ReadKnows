name: 'ollama'
services:
  ollama:
    restart: always
    image: ollama/ollama
    container_name: ollama
    runtime: nvidia  # GPU支持
    environment:
      - TZ=Asia/Shanghai
      - NVIDIA_VISIBLE_DEVICES=all
    networks:
      - ai-tier
    ports:
      - "11434:11434"
    volumes:
      - ./data:/root/.ollama
networks:
  ai-tier:
    name: ai-tier
    driver: bridge
networks:
  readknows-network:
    name: readknows-network
    driver: bridge
    # 允许容器访问宿主机局域网
    # 默认情况下，bridge网络应该可以访问宿主机可以访问的网络
    # 如果无法访问，可能需要配置iptables或使用host网络模式
    # 注意：bridge 网络默认允许容器访问宿主机网络，但某些防火墙规则可能阻止
    # 如果遇到网络问题，可以尝试：
    # 1. 检查宿主机防火墙设置
    # 2. 确保 Docker 的 iptables 规则正确
    # 3. 使用 host.docker.internal 访问宿主机服务
    # 4. 使用实际局域网 IP 访问其他机器上的服务

